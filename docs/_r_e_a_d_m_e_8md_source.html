<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>TriggerApplication: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TriggerApplication
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_r_e_a_d_m_e_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor"># TriggerApplication</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Trigger Application is designed as a modular trigger software to run successive triggers on WCSim data. </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;It<span class="stringliteral">&#39;s built from ToolDAQ Application [[1]](#myfootnote1) which is an open source general DAQ Application template built using the modular ToolDAQ Framework core [[2]](#myfootnote2) to give separation between core and implementation code.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral">****************************</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="stringliteral"># Concept</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="stringliteral">****************************</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral">The main executable creates a ToolChain which is an object that holds Tools. Tools are added to the ToolChain and then the ToolChain can be told to Initialise Execute and Finalise each tool in the chain.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="stringliteral">The ToolChain also holds a user-defined DataModel which each tool has access too and can read, update and modify. This is the method by which data is passed between Tools.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="stringliteral">User Tools can be generated for use in the tool chain by including a Tool header. This can be done manually or by use of the newTool.sh script.</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="stringliteral">For more information consult the ToolDAQ doc.pdf</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="stringliteral">https://github.com/ToolDAQ/ToolDAQFramework/blob/master/ToolDAQ%20doc.pdf</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="stringliteral">****************************</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="stringliteral"># Tutorial</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="stringliteral">Note that there are `README.md` files in most folders. Check them out!</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="stringliteral">* [Key concepts](#key-concepts)</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="stringliteral">  * [Tool](#tool)</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="stringliteral">  * [Toolchain](#toolchain)</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">  * [DataModel](#datamodel)</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral">* [Installation](#installation)</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="stringliteral">  * [Docker](#docker)</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="stringliteral">  * [From GitHub source](#from-github-source)</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="stringliteral">* [Running](#running)</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="stringliteral">  * [Creating your own trigger chain](#creating-your-own-trigger-chain)</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="stringliteral">  * [Creating your own trigger](#creating-your-own-trigger)</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="stringliteral">## Key concepts</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="stringliteral">### Tool</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="stringliteral">A tool is a class that does something. They are found in the `UserTools` directory. Examples includes</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="stringliteral">* `WCSimReader` -- Reads in WCSim files</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="stringliteral">* `nhits` -- Runs an nhits trigger</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="stringliteral">* `DataOut` -- Writes out WCSim-format files with only triggered digits</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="stringliteral">Each tool implements 3 methods</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="stringliteral">* `Initialise()` -- Is run once at the start. Read configuration, setup trees, etc. here.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="stringliteral">* `Execute()` -- Is run once per event. Do the main work of the tool here.</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="stringliteral">* `Finalise()` -- Is run once at the end. Close &amp; write files, `delete` memory, etc. here</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="stringliteral">### Toolchain</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="stringliteral">A toolchain is a collection of tools, along with configuration files. They are found in the `configfiles` directory. For example</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="stringliteral">* `WCSimReader` - `nhits` - `DataOut` -- Reads a WCSim file, triggers on it, and writes out a new WCSim-formatted file</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="stringliteral">Note that you can use the same tool multiple times, with different (or the same) configuration</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral">Note that tools are run consecutively. i.e. if you have two tools (t1, t2) the following order will be used:</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="stringliteral">* `t1::Initialise()` - `t2::Initalise()` - `t1::Execute()` - `t2::Execute()` - `t1::Execute()` - `t2::Execute()` - ... - `t1::Finalise()` - `t2::Finalise()`</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="stringliteral">### DataModel</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="stringliteral">Tools cannot communicate directly with one another. They rely on passing data between each other using a transient data model. This is found in the `DataModel` folder</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="stringliteral">## Installation</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="stringliteral">### Docker</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="stringliteral">Docker is a platform independent container system which eases the headache of long installation and incompatibility problems. By creating a container form the image you will have a native Centos 7 terminal with all the prerequisites installed and the software guaranteed to work.</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="stringliteral">1) Install docker check either your platforms package manager or https://www.docker.com for the software</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="stringliteral">2) Get the latest container image `docker pull hkdaq/triggerapplication:latest`</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral">3) Run an instance of the container which will have the trigger application and all dependencies installed `docker run --name=TriggerApplication -it hkdaq/triggerapplication:latest` Note: only run once or you will make multiple contianers</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral">Once the container has started to run the software</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">1) `./main`</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral">  * This runs an example toolchain with two versions of the `dummy` tool. It&#39;</span>s essentially a Hello World tool</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;You<span class="stringliteral">&#39;re then free to install any applications in your container you wish for development</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="stringliteral">* If you are using optional packages (e.g. [hk-BONSAI](https://github.com/hyperk/hk-BONSAI) or [FLOWER](https://github.com/HKDAQ/FLOWER)) install them in `$HYPERKDIR` and they will automatically be found whenever you start your container (and `Build.h` and `$LD_LIBRARY_PATH` will be set appropriately).</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="stringliteral">  * If you do install such packages, remember to `source Setup.sh` (or exit the container and come back in if you&#39;</span>ve installed them in `$HYPERKDIR`), and `make clean; make` again, in order to build the tools that depend on the optional packages (e.g. the <a class="code" href="class_b_o_n_s_a_i.html">BONSAI</a> tool <span class="keywordflow">for</span> the hk-<a class="code" href="class_b_o_n_s_a_i.html">BONSAI</a> package)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;Notes: </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;* To exit a container use `exit` </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;* To restart a container use `docker <a class="code" href="include_2library__daq_8h.html#ac12384e371607d235ed59acbc1b1f54b">start</a> -i TriggerApplicaiton`</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;* To see current containers use `docker ps -a`</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;* To <span class="keyword">delete</span> a container use `docker rm TriggerApplciaiton`</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;* When creating a container you can mount a folder from your native os with the `-v` run option e.g. `docker run --name=TriggerApplication -v local_folder_path:container_mount_path -it hkdaq/triggerapplication:latest`</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">### From GitHub source</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;* Clone from https:<span class="comment">//github.com/HKDAQ/TriggerApplication</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  * Note the model used to commit to the <a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> version of TriggerApplication is fork and pull request. So <span class="keywordflow">do</span> fork <span class="keywordflow">if</span> you need to!</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;* Make sure you have sourced WCSim i.e. that you have `$WCSIMDIR` set</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  * Note that <span class="keyword">this</span> will work with the current WCSim develop branch.</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    * Versions of WCSim older than v1.8.0 will almost certainly not work. (`kTriggerNoTrig` added in v1.8.0; `WCSimRootOptions` added in v1.7.0)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  * Note that you also need ROOT setup (a WCSim prerequisite)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;* (Optional) If you want to run the <a class="code" href="class_b_o_n_s_a_i.html">BONSAI</a> tool, make sure you have sourced [hk-<a class="code" href="class_b_o_n_s_a_i.html">BONSAI</a>](https:<span class="comment">//github.com/hyperk/hk-BONSAI) i.e. that you have `$BONSAIDIR` set</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;* (Optional) If you want to run the FLOWER tool, make sure you have sourced [FLOWER](https:<span class="comment">//github.com/HKDAQ/FLOWER) i.e. that you have `$FLOWERDIR` set</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;* (Optional) <span class="keywordflow">for</span> compiling over GPU, set the CUDADIR variable, <span class="keywordflow">for</span> example export CUDADIR=<span class="stringliteral">&quot;/usr/local/cuda&quot;</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;* Run `./GetToolDAQ.sh`</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  * This gets and compiles the prerequisites: ToolDAQ, boost, and zmq</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  * You can optionally install Root</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  * `./GetToolDAQ.sh --help` <span class="keywordflow">for</span> the flags to turn on/off each of the prerequisites</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;To <a class="code" href="include_2helper__cuda_8h.html#a8170bd02e7804fbab5e561bf676decd0">check</a> it has built successfully:</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;* `source Setup.sh`</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;* Check it runs with `./<a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>`</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  * This runs an example toolchain with two versions of the `dummy` tool. It<span class="stringliteral">&#39;s essentially a Hello World tool</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="stringliteral">#### Installing an optional package later</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="stringliteral">If you do install optional packages after the initial compliation of TriggerApplication, once they are setup correctly (see above) it is a two-step process to build the tools that depend on the optional packages</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="stringliteral">* `source Setup.sh`</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="stringliteral">* `make clean; make`</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="stringliteral">#### GPU code</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="stringliteral">Some triggers have been developed to be run on CUDA-compatible GPUs.</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="stringliteral">If you want to use these (and you have a compatible system)</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="stringliteral">* `source Setup.sh`</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="stringliteral">* `make GPU`</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="stringliteral">* `./mainGPU`</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="stringliteral">## Running</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="stringliteral">1. Choose the toolchain you want to run</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="stringliteral">  * We use `WCSimReaderTest` as an example</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="stringliteral">  * See https://github.com/WCSim/WCSim for how to compile and run WCSim</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="stringliteral">    * Running `cd $WCSIMDIR; ./bin/Linux-g++/WCSim WCSim.mac` will create the expected output file for this tutorial.</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="stringliteral">2. Check the configuration files are doing what you want them to in `configfiles/WCSimReaderTest`</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="stringliteral">  * `ToolChainConfig` -- Sets up how many events to run on, what to do on errors, etc. You probably don&#39;</span>t need to alter <span class="keyword">this</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  * `ToolsConfig` -- Select which tool(s) you want to use, and the configuration file of each version of the tool</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  * `WCSimReaderToolConfig` -- Options <span class="keywordflow">for</span> the `<a class="code" href="class_w_c_sim_reader.html">WCSimReader</a>` tool. Select the input file(s), number of events to loop over, and tool verbosity</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    * Note the <span class="keywordflow">default</span> WCSim input file is `$WCSIMDIR/wcsim.root`</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  * `nhitsToolConfig` -- Select the trigger options (e.g. threshold), whether to apply it to ID or OD digits, and tool verbosity</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  * `DataOutToolConfig` -- Select the output filename, whether to save multiple digits per PMT per trigger, the digit time offset, and tool verbosity.</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    * Note the <span class="keywordflow">default</span> output file is `triggered.root`</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;3. Run as `./<a class="code" href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> WCSimReaderTest`</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="preprocessor">## Creating your own trigger chain</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;1. `cd $ToolDAQapp/configfiles`</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;2. `./Create_run_config.sh TOOLCHAINNAME`</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;3. Write you configuration files in `$ToolDAQapp/configfiles/TOOLCHAINNAME`</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;4. `cd $ToolDAQapp`</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  * Note you can setup your configuration files with absolute paths such that you don<span class="stringliteral">&#39;t need to `cd`</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="stringliteral">5. Run with `./main TOOLCHAINNAME`</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">## Creating your own trigger</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">1. `cd $ToolDAQapp/UserTools`</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="stringliteral">2. `./newTool.sh TOOLNAME`</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">   * Note the convention for triggers is to start TOOLNAME with a lower case. For other tools, start with an upper case</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral">3. Write your trigger in the new class that has been created (`$ToolDAQapp/UserTools/TOOLNAME/TOOLNAME.{cpp,h}`files</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="stringliteral">   * Implement `Initalise()`</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">     * `m_variables.Get(&quot;verbose&quot;, verbose);` is an example of reading in configuration options</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">   * Implement `Execute()`</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="stringliteral">     * Triggers shouldn&#39;</span>t read truth information (although you could implement truth cherry pickers...) so you should only use the following from the <a class="code" href="class_data_model.html">DataModel</a> `m_data`</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;       * **Inputs**</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;         * `IDSamples` and `ODSamples` contain all the digit information i.e. charge, time, tubeID</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;         * `IDGeom` and `ODGeom` contain all the PMT information i.e tubeID, x, y, z</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;           * Note that <span class="keyword">this</span> can be expanded to include e.g. PMT rotation</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;       * **Outputs**</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;         * Use `<a class="code" href="class_trigger_info.html#a29808bd2956d4561fa6e5f77bb23ab60">TriggerInfo::AddTrigger</a>()` to save triggers in `IDTriggers` or `ODTriggers`</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;     * You can implement both CPU and CUDA-based GPU versions of your code</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;       * It is recommended to always have a CPU version of the code, since <span class="keyword">this</span> allows anyone to use it; access to GPUs is not ubiquitous</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;       * Use the following to select the correct version of the code, and hide GPU code from systems that cannot compile it </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        ```</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">        #ifdef GPU</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor"></span>        <span class="comment">// GPU code</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">        #else</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="preprocessor"></span>        <span class="comment">// CPU CODE</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="preprocessor">        #endif //GPU</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="preprocessor"></span>        ```</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   * Implement `Finalise()`</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;     * Remember to `<span class="keyword">delete</span>` any memory you<span class="stringliteral">&#39;ve allocated</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="stringliteral">   * Check other triggers for more information</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="stringliteral">      * `pass_all` is a very simple example</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="stringliteral">      * `nhits` is a relatively simple example. It has CPU and GPU versions</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="stringliteral">4. Use `make` and/or `makeGPU` to build it</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="stringliteral">   (you will need to create an environment variable CUDADIR pointing to your system CUDA installation, for example export CUDADIR=&quot;/usr/local/cuda&quot; or export CUDADIR=&quot;/usr/local/cuda-8.0&quot;)</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="stringliteral">5. Add your tool to a toolchain to test it with `./main TOOLCHAINNAME`</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="stringliteral">  * Or `./mainGPU TOOLCHAINNAME` for GPU code</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="stringliteral">6. Write the README: `$ToolDAQapp/UserTools/TOOLNAME/README.md`</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="stringliteral">****************************</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="stringliteral">Copyright (c) 2018 Hyper-k Collaboration</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="stringliteral">&lt;a name=&quot;myfootnote1&quot;&gt;[1]&lt;/a&gt; Benjamin Richards. (2018, November 11). ToolDAQ Application v2.1.2 (Version V2.1.2). Zenodo. http://doi.org/10.5281/zenodo.1482772</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="stringliteral">&lt;a name=&quot;myfootnote2&quot;&gt;[2]&lt;/a&gt; Benjamin Richards. (2018, November 11). ToolDAQ Framework v2.1.1 (Version V2.1.1). Zenodo. http://doi.org/10.5281/zenodo.1482767 </span></div>
<div class="ttc" id="class_w_c_sim_reader_html"><div class="ttname"><a href="class_w_c_sim_reader.html">WCSimReader</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2_w_c_sim_reader_8h_source.html#l00016">WCSimReader.h:16</a></div></div>
<div class="ttc" id="class_trigger_info_html_a29808bd2956d4561fa6e5f77bb23ab60"><div class="ttname"><a href="class_trigger_info.html#a29808bd2956d4561fa6e5f77bb23ab60">TriggerInfo::AddTrigger</a></div><div class="ttdeci">void AddTrigger(TriggerType_t type, double starttime, double endtime, double triggertime, std::vector&lt; float &gt; info)</div><div class="ttdoc">Add a trigger, all times in ns. </div><div class="ttdef"><b>Definition:</b> <a href="_trigger_info_8cpp_source.html#l00021">TriggerInfo.cpp:21</a></div></div>
<div class="ttc" id="class_data_model_html"><div class="ttname"><a href="class_data_model.html">DataModel</a></div><div class="ttdef"><b>Definition:</b> <a href="_data_model_2_data_model_8h_source.html#l00026">DataModel.h:26</a></div></div>
<div class="ttc" id="include_2library__daq_8h_html_ac12384e371607d235ed59acbc1b1f54b"><div class="ttname"><a href="include_2library__daq_8h.html#ac12384e371607d235ed59acbc1b1f54b">start</a></div><div class="ttdeci">cudaEvent_t start</div><div class="ttdef"><b>Definition:</b> <a href="include_2library__daq_8h_source.html#l00150">library_daq.h:150</a></div></div>
<div class="ttc" id="include_2helper__cuda_8h_html_a8170bd02e7804fbab5e561bf676decd0"><div class="ttname"><a href="include_2helper__cuda_8h.html#a8170bd02e7804fbab5e561bf676decd0">check</a></div><div class="ttdeci">void check(T result, char const *const func, const char *const file, int const line)</div><div class="ttdef"><b>Definition:</b> <a href="include_2helper__cuda_8h_source.html#l00891">helper_cuda.h:891</a></div></div>
<div class="ttc" id="main_8cpp_html_a0ddf1224851353fc92bfbff6f499fa97"><div class="ttname"><a href="main_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a></div><div class="ttdeci">int main(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="main_8cpp_source.html#l00005">main.cpp:5</a></div></div>
<div class="ttc" id="class_b_o_n_s_a_i_html"><div class="ttname"><a href="class_b_o_n_s_a_i.html">BONSAI</a></div><div class="ttdef"><b>Definition:</b> <a href="include_2_b_o_n_s_a_i_8h_source.html#l00014">BONSAI.h:14</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 2 2020 17:27:57 for TriggerApplication by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
